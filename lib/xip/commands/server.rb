# frozen_string_literal: true

require 'rack/handler/puma'
require 'xip/commands/command'

module Xip
  module Commands
    class Server < Command
      def initialize(port:)
        @port = port
        $stdout.sync = true
      end

      def start
        # Rack::Handler::Puma.run(Xip::Server)
        puts ascii_art
        exec "foreman start -f Procfile.dev -p #{@port}"
      end

      private

        def ascii_art
          <<~ART
            ,,,,,,,,,,,                                      ,,,,,,..,,,,,
          ░░░░░░░░░░░░░░≥                                  ╔╬╠╠╠╠╠╠╠╠╠╠╠╠╠⌐
          ░░░░░░░░░░░░░░░░≥,                             é╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠⌐
          ░░░░░░░░░░░░░░░░░░░,                        ,@╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠⌐
          ░░░░░░░░░░░░░░░░░░░░▒≥                    ╓╬╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠⌐
          ░░░░░░░░░░░░░░░░░░░░░░░≥                ╓╬╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠⌐
          ░░░░░░░░░░░░░░░░░░░░░░░░░≥            ╔╬╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠⌐
           `╚░░░░░░░░░░░░░░░░░░░░░░░░≥,       é╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╜
             `╙░░░░░░░░░░░░░░░░░░░░░░░░      ╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╙
                %░░░░░░░░░░░░░░░░░░░░░░      ╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╬"
                  "░░░░░░░░░░░░░░░░░░░░      ╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╩
                    "░░░░░░░░░░░░░░░░░░      ╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╩²
                      `╚░░░░░░░░░░░░░░░      ╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╜
                        `╙░░░░░░░░░░░░░      ╠╠╠╠╠╠╠╠╠╠╠╠╠╠╙


                         ╔φφφφφφφφφφφφφ      ≥≥≥≥≥≥≥≥≥≥≥≥≥≥
                       ╔╬╠╠╠╠╠╠╠╠╠╠╠╠╠╠      ░░░░░░░░░░░░░░░≥
                    ,#╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠      ░░░░░░░░░░░░░░░░░≥
                  ,ê╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠      ░░░░░░░░░░░░░░░░░░░≥,
                ²╬╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠      ░░░░░░░░░░░░░░░░░░░░░░,
              ╔╬╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠      ░░░░░░░░░░░░░░░░░░░░░░░▒≥
            ╔╬╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╩      "░░░░░░░░░░░░░░░░░░░░░░░░░≥
          #╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╜          "░░░░░░░░░░░░░░░░░░░░░░░░░≥
          ╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╙              `≥░░░░░░░░░░░░░░░░░░░░░░░
          ╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╩"                   ░░░░░░░░░░░░░░░░░░░░░░
          ╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╩                        ²░░░░░░░░░░░░░░░░░░░
          ╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╩                            "░░░░░░░░░░░░░░░░░
          ╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╜                                "░░░░░░░░░░░░░░░
          ╚╚╚╚╚╩╩╩╩╩╩╩╩╙                                    `============²



                                Xip v#{Xip::VERSION}

          ART
        end
    end
  end
end
